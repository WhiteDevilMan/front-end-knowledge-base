# useIsSsr

## Описание

Если в вашем проекте используется SSR, иногда может быть полезным знать, на чьей стороне происходит рендер - сервер (server-side) или клиент (client-side). Например для предотвращения ошибок гидратации. Данное решение предоставляет контекст `IsSsrProvider` и хук `useIsSsr`, который берёт булевое значение из контекста. 

Используется компонентом [ClientOnly](../../components/ClientOnly/).

**Важно**: не злоупотребляйте этим хуком - он предназначен только для случаев, когда ошибок гидратации избежать невозможно. Старайтесь всегда решать проблемы гидратации без обходных путей.

## Использование

1. Оберните ваше приложение в компонент `IsSsrProvider`. Обычно это делается в  `App.tsx` файле.
2. Вызовите хук `useIsSsr` в нужном компоненте. Хук вернёт булевое значение, где `true` - server-side, `false` - client-side. 


## Зависимости

`react`

## Как это работает?

В общем-то говоря, что бы узнать, на чьей стороне сейчас выполняется код, достаточно сделать проверку `typeof window === 'undefined'`. На сервере нет объекта `window`, следовательно если проверка вернёт `true` - значит мы на сервере. Тогда зачем нам использовать контекст и хук? Ответ - для предовтращения ошибок гидратации, то есть разницы между тем, что отрендерил сервер и **первым** клиентским рендером. 

Обратите внимание на хук `useCheckIsSsr`, в котором происходит две простые вещи - 1) объявляется состояние `isSsr` с начальным значением `true`; 2) Это состояние сбрасывается в `false` в `useEffect`. Хук `useEffect` выполняется **после** первого рендера и только на клиенте, следовательно значение состояния `isSsr` на сервере и во время **первого** рендера будет одинаковым - `true`. А значит, мы можем отрендерить одинаковое содержимое по значению `isSsr === true`.

Примечание: хук `useCheckIsSsr` не предназначен для прямого использования в компонентах, поэтому не экспортируется наружу. При вызове в компоненте, его поведение не будет соответствовать поведению SSR. Server-side отрабатывает только при первой загрузке страницы, а затем при навигации по сайту происходит клиентский раутинг, то есть server-side не участвует. Предположим вы вызвали `useCheckIsSsr` на странице. Страница будет монтироваться/размонтироваться при навигации по сайту и состояние `useCheckIsSsr` будет сбрасываться, хотя server-side уже никак не участвует.